# 性能测试 - 峰值测试
# 运行: ./workflow-engine run examples/13-spike-test.yaml

id: spike-test
name: Spike Test
description: 模拟突发流量的峰值测试示例

options:
  mode: ramping-vus
  stages:
    # 正常负载
    - duration: 1m
      target: 10
      name: "Normal load"
    # 突然增加到峰值
    - duration: 10s
      target: 100
      name: "Spike up"
    # 保持峰值
    - duration: 30s
      target: 100
      name: "Peak load"
    # 恢复正常
    - duration: 10s
      target: 10
      name: "Spike down"
    # 继续正常负载
    - duration: 1m
      target: 10
      name: "Recovery"
  thresholds:
    - metric: http_req_duration
      condition: "p(95) < 1000" # 峰值期间允许更高延迟
    - metric: http_req_failed
      condition: "rate < 0.1" # 峰值期间允许更高错误率

steps:
  - id: api_request
    name: API Request
    type: http
    config:
      method: GET
      url: "https://httpbin.org/get"
    timeout: 30s
