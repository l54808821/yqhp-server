# Foreach 循环示例
# 运行: ./workflow-engine run examples/20-loop-foreach.yaml

id: loop-foreach-example
name: Foreach Loop Example
description: 使用 foreach 循环遍历集合

variables:
  base_url: "https://httpbin.org"
  users:
    - id: 1
      name: "Alice"
    - id: 2
      name: "Bob"
    - id: 3
      name: "Charlie"

steps:
  # 步骤 1: 遍历用户列表
  - id: foreach_users
    name: Foreach Users
    type: loop
    loop:
      mode: foreach
      items: "${users}"
      item_var: user
      steps:
        - id: log_user
          name: Log User
          type: script
          config:
            script: |
              const user = ctx.GetVariable('user');
              console.log('Processing user: ' + user.name + ' (ID: ' + user.id + ')');
              console.log('Index: ' + ctx.GetVariable('loop.index'));

        - id: get_user_info
          name: Get User Info
          type: http
          config:
            method: GET
            url: "${base_url}/get"
            query:
              user_id: "${user.id}"
              user_name: "${user.name}"
          timeout: 10s

  # 步骤 2: 遍历简单数组
  - id: foreach_numbers
    name: Foreach Numbers
    type: loop
    loop:
      mode: foreach
      items:
        - 10
        - 20
        - 30
      item_var: num
      steps:
        - id: log_number
          name: Log Number
          type: script
          config:
            script: |
              const num = ctx.GetVariable('num');
              console.log('Number: ' + num);

  # 步骤 3: 记录完成
  - id: complete
    name: Complete
    type: script
    config:
      script: |
        console.log('Foreach loop completed!');
