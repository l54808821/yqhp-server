# While 循环示例
# 运行: ./workflow-engine run examples/21-loop-while.yaml

id: loop-while-example
name: While Loop Example
description: 使用 while 循环执行条件迭代

variables:
  base_url: "https://httpbin.org"
  counter: 0
  max_count: 5

steps:
  # 步骤 1: 使用 while 循环
  - id: while_loop
    name: While Loop
    type: loop
    loop:
      mode: while
      condition: "${counter} < ${max_count}"
      max_iterations: 100 # 安全限制，防止无限循环
      steps:
        - id: log_counter
          name: Log Counter
          type: script
          config:
            script: |
              const counter = ctx.GetVariable('counter');
              console.log('Counter: ' + counter);
              console.log('Iteration: ' + ctx.GetVariable('loop.iteration'));

        - id: http_request
          name: HTTP Request
          type: http
          config:
            method: GET
            url: "${base_url}/get"
            query:
              counter: "${counter}"
          timeout: 10s

        - id: increment_counter
          name: Increment Counter
          type: script
          config:
            script: |
              const counter = ctx.GetVariable('counter');
              ctx.SetVariable('counter', counter + 1);

  # 步骤 2: 记录完成
  - id: complete
    name: Complete
    type: script
    config:
      script: |
        const finalCounter = ctx.GetVariable('counter');
        console.log('While loop completed! Final counter: ' + finalCounter);
